- fail:
    msg: "You need to provide role_type and tld_name_external or alb_route53_dns"
  when: alb_route53_dns == 'ERROR.ERROR'

- name: Determine ALB facts
  elb_application_lb_facts:
    profile: "{{ profile|default(omit) }}"
    region: "{{ region }}"
    names: "{{ load_balancer_name }}"
  register: elb_application_lb_facts

- name: Point DNS at ALBs
  include_role:
    name: aws_route53
  vars:
    aws_route53_profile: "{{  aws_route53_profile_public|default(profile|default()) }}"
    aws_route53:
      private_zone: no
      zone: "{{ tld_name_external }}"
      record: "{{ alb_route53_dns|default(role_type + '.' + tld_name_external) }}"
      value: "{{ elb_application_lb_facts.load_balancers[0].dns_name }}"
      type: CNAME

  when: target_groups
